Lab: Implementing Secure File Access
Scenario
You are working as an administrator at A. Datum Corporation. The company has a wide and complex file
server infrastructure. It manages access control to folder shares by using NTFS ACLs, but in some cases,
that approach does not provide the desired results.
Most of the files used by departments are stored in shared folders dedicated to specific departments, but
confidential documents sometimes appear in other shared folders. Only members of the Research team
should be able to access Research team folders, and only Executive department managers should be able
to access highly confidential documents.
The Security department also is concerned that managers are accessing files by using their home
computers, which might not be highly secure. Therefore, you must create a plan for securing documents
regardless of where they are located, and you must ensure that documents can be accessed from
authorized computers only. Authorized computers for managers are members of the security group
ManagersWks.
The Support department reports that a high number of calls are generated by users who cannot access
resources. You must implement a feature that helps users understand error messages better and will
enable them to request access automatically.
Quite a few users use personal devices such as tablets and laptops to work from home and at work. You
have to provide them with an efficient way to synchronize business data on all the devices that they use.
Objectives

After completing this lab, you will be able to:
• Prepare for DAC deployment.
• Implement DAC.
• Validate and remediate DAC.
• Implement Work Folders.

Lab: Implementing Secure File Access

Exercise 1: Preparing for DAC Deployment

Task 1: Preparing AD DS for DAC deployment

1. On LON-DC1, in Server Manager, click Tools, and then click Active Directory Domains and Trusts.
2. In the Active Directory Domains and Trusts console, right-click Adatum.com, and then select Raise
Domain Functional Level.
3. In the Raise domain functional level window, in the Select an available domain functional level
drop-down list box, select Windows Server 2012, click Raise, and then click OK twice.
Note: If you get an error message, force the replication between LON-DC1 ,
and then try again.
4. Right-click Active Directory Domains and Trusts [LON-DC1.Adatum.com], and then click Raise
Forest Functional Level….
5. In the Raise forest functional level window, in the Select an available forest functional level dropdown list box, select Windows Server 2022, click Raise, and then click OK twice.
Note: If you get an error message, force the replication between LON-DC1 ,
and then try again.
6. Close the Active Directory Domains and Trusts console.
7. On LON-DC1, in Server Manager, click Tools, and then click Active Directory Users and Computers.
8. In Active Directory Users and Computers, right-click Adatum.com, click New, and then click
Organizational Unit.
9. In the New Object – Organizational Unit dialog box, in the Name field, type DAC Protected, and
then click OK.
10. Click the Computers container.
11. Select LON-SVR1, LON-SVR2, and LON-SVR3, right click and then click Move.
12. In the Move window, click DAC Protected, and then click OK.
13. Close Active Directory Users and Computers.
14. On LON-DC1, in Server Manager, click Tools, and then click Group Policy Management.
Note: If the console does not open and a dialog box appears that says Group Policy
Management is loading, close the dialog box, and then try to open the Group Policy
Management Console again.
15. Expand Forest: Adatum.com, expand Domains, expand Adatum.com, and then click the Group
Policy Objects container.
16. In the results pane, right-click Default Domain Controllers Policy, and then click Edit.
17. In the Group Policy Management Editor, under Computer Configuration, expand Policies, expand
Administrative Templates, expand System, and then click KDC.
18. In the details pane, double-click KDC support for claims, compound authentication and Kerberos
armoring.
19. In the KDC support for claims, compound authentication and Kerberos armoring window, select
Enabled, in the Options section, click the drop-down list box, select Always provide claims, and
then click OK.
20. Close Group Policy Management Editor window and the Group Policy Management Console.
21. On the taskbar, click the Windows PowerShell icon.
22. At the command prompt for the Windows PowerShell command-line interface, type
gpupdate /force, and then press Enter. After Group Policy updates, close Windows PowerShell.
24. On LON-DC1, in Server Manager, click Tools, and then click Active Directory Users and Computers.
25. Expand Adatum.com, right-click Users, click New, and then click Group.
26. In the Group name field, type ManagersWKS, and then click OK.
27. Click the DAC Protected container, right-click LON-SVR1, and then click Properties.
28. Click the Member Of tab, and then click Add.
29. In Select Groups window, type ManagersWKS, click Check Names, and then click OK twice.
30. Click the Managers organizational unit (OU), right-click Aidan Delaney, and then click Properties.
31. In the Aidan Delaney Properties dialog box, click the Organization tab. Ensure that the
Department field is populated with the value Managers, and then click Cancel.
32. Click the Research OU, right-click Allie Bellew, and then click Properties.
33. In the Allie Bellew Properties dialog box, click the Organization tab. Ensure that the Department
field is populated with the value Research, and then click Cancel.
34. Close Active Directory Users and Computers.


Task 2: Configuring user and device claims

1. On LON-DC1, click Tools and then click Active Directory Administrative Center.
2. In the Active Directory Administrative Center, in the navigation pane, click Dynamic Access Control,
and then double-click Claim Types.
3. In the Claim Types container, in the Tasks pane, click New, and then click Claim Type.
4. In the Create Claim Type window, in the Source Attribute section, select department.
5. In the Display name text box, type Company Department.
6. Select the User and Computer check boxes.
7. Scroll down to the Suggested Values section, select The following values are suggested: option,
and then click Add….
8. In the Add a suggested value window, type Managers in both the Value and Display name fields,
click OK, and then click Add….
9. In the Add a suggested value window, type Research in both the Value and Display name fields,
and then click OK twice.
10. In the Active Directory Administrative Center, in the Tasks pane, click New, and then select Claim
Type.
11. In the Create Claim Type window, in the Source Attribute section, click description.
12. Clear the User check box, select the Computer check box, and then click OK.

Task 3: Configuring Resource Properties and Resource Property Lists

1. In the Active Directory Administrative Center, click Dynamic Access Control.
2. In the central pane, double-click Resource Properties.
3. In the Resource Properties list, right-click Department, and then click Enable.
4. In the Resource Properties list, right-click Confidentiality, and then click Enable.
5. In the Resource Property List, ensure that both the Department and Confidentiality properties are
enabled.
6. Double-click Department, scroll down to the Suggested Values section, and then click Add.
7. In the Add a suggested value window, in both the Value and Display name text boxes, type
Research, and then click OK twice.
8. Click Dynamic Access Control, and then double-click Resource Property Lists.
9. In the central pane, double-click Global Resource Property List, ensure that both Department and
Confidentiality display, and then click Cancel. If they do not display, click Add, add these two
properties, and then click OK.
10. Close the Active Directory Administrative Center.


Task 4: Implementing file classifications

1. On LON-SVR1, in Server Manager, click Tools, and then click File Server Resource Manager.
2. In File Server Resource Manager, expand Classification Management.
3. Select and right-click Classification Properties, and then click Refresh.
4. Verify that the Confidentiality and Department properties are listed.
5. Click Classification Rules, and in the Actions pane, click Create Classification Rule.
6. In the Create Classification Rule window, for the Rule name, type Set Confidentiality.
7. Click the Scope tab, and then click Add.
8. In the Browse For Folder dialog box, expand Local Disk (C:), click the Docs folder, and then
click OK.
9. Click the Classification tab. Make sure that following settings are set, and then click Configure:
o Classification method: Content Classifier
o Property: Confidentiality
o Value: High
10. In the Classification Parameters dialog box, click the Regular expression drop-down list box, and
then click String.
11. In the Expression field next to the word String, type secret, and then click OK.
12. Click the Evaluation Type tab, select Re-evaluate existing property values, click Overwrite the
existing value, and then click OK.
13. In File Server Resource Manager, in the Actions pane, click Run Classification with all rules now.
14. Click Wait for classification to complete, and then click OK.
15. After the classification is complete, you will be presented with a report. Verify that two files were
classified. You can confirm this in Report Totals section.
16. Close the report.
17. On the taskbar, click the File Explorer icon.
18. In the File Explorer window, expand Local Disk (C:), and then expand the Docs folder.
19. In the Docs folder, right-click Doc1.txt, click Properties, and then click the Classification tab. Verify
that Confidentiality is set to High.
20. Repeat step 19 on files Doc2.txt and Doc3.txt. Doc2.txt should have same Confidentiality as Doc1.txt,
while Doc3.txt should have no value. This is because only Doc1.txt and Doc2.txt have the word
“secret” in their content.

Task 5: Assign property to the Research folder

1. On LON-SVR1, open File Explorer, and then browse to Local Disk (C:).
2. Right-click the Research folder, and then click Properties.
3. Click Classification tab, and then click Department.
4. In the Value section, click Research, click Apply, and then click OK.
Results: After completing this exercise, you will have prepared Active Directory Domain Services (AD DS)
for DAC deployment, configured claims for users and devices, and configured Resource Properties to
classify files.


Exercise 2: Implementing DAC


Task 1: Configure Central Access Rules

1. On LON-DC1, in Server Manager, click Tools, and then click Active Directory Administrative
Center.
2. In the Active Directory Administrative Center, in the navigation pane, click Dynamic Access Control,
and then double-click Central Access Rules.
3. In the Tasks pane, click New, and then click Central Access Rule.
4. In the Create Central Access Rule dialog box, in the Name field, type Department Match.
5. In the Target Resources section, click Edit.
6. In the Central Access Rule dialog box, click Add a condition.
7. Set a condition as Resource-Department-Equals-Value-Research, and then click OK.
8. In the Permissions section, click Use following permissions as current permissions.
9. In the Permissions section, click Edit.
10. Remove permission for Administrators.
11. In Advanced Security Settings for Permissions, click Add.
12. In Permission Entry for Permissions, click Select a principal.
13. In the Select User, Computer, Service Account, or Group window, type Authenticated Users, click
Check Names, and then click OK.
14. In the Basic permissions section, select the Modify, Read and Execute, Read and Write check boxes.
15. Click Add a condition, click the Group drop-down list box, and then click Company Department.
16. Click the Value drop-down list box, and then click Resource.
17. In the last drop-down list box, click Department, and then click OK three times.
Note: You should have this expression as a result:
User-Company Department-Equals- Resource-Department.
18. In the Tasks pane, click New, and then click Central Access Rule.
19. For the name of rule, type Access Confidential Docs.
20. In the Target Resources section, click Edit.
21. In the Central Access Rule window, click Add a condition.
22. In the last drop-down list box, click High, and then click OK.
Note: You should have this expression as a result: Resource-Confidentiality-Equals-Value-High.
23. In the Permissions section, click Use following permissions as current permissions, and then, click
Edit.
24. Remove permission for Administrators.
25. In Advanced Security Settings for Permissions, click Add.
26. In Permission Entry for Permissions, click Select a principal.
27. In the Select User, Computer, Service Account, or Group window, type Authenticated Users, click
Check Names, and then click OK.
28. In the Basic permissions section, select the Modify, Read and Execute, Read, and Write check boxes.
29. Click Add a condition. Set the first condition to User-Company Department-Equals-ValueManagers, and then click Add a condition.
Note: Value Managers should be in last drop down list.
30. Set the second condition to Device-Group-Member of each-Value-ManagersWKS, and then click
OK three times.
Note: If you cannot find ManagersWKS in the last drop-down list box, click Add items.
Then in the Select Computer or Group window, type ManagersWKS, click Check Names, and
then click OK.

Task 2: Configure central access policies

1. On LON-DC1, in the Active Directory Administrative Center, click Dynamic Access Control, and then
double-click Central Access Policies.
2. In the Tasks pane, click New, and then click Central Access Policy.
3. In the Name field, type Protect confidential docs, and then click Add.
4. Click the Access Confidential Docs rule, click >>, and then click OK twice.
5. In the Tasks pane, click New, and then click Central Access Policy.
6. In the Name field, type Department Match, and then click Add.
7. Click the Department Match rule, click >>, and then click OK twice.
8. Close the Active Directory Administrative Center.

Task 3: Apply central access policies to a file server

1. On LON-DC1, in Server Manager, click Tools, and then click Group Policy Management.
Note: If the console does not open and a dialog box appears that says Group Policy
Management is loading, close the dialog box, and then try to open Group Policy Management
console again.
2. In the Group Policy Management Console, under Domains, expand Adatum.com, right-click DAC
Protected, and then click Create a GPO in this domain, and Link it here.
3. Type DAC Policy, and then click OK.
4. Right-click DAC Policy, and then click Edit.
5. Expand Computer Configuration, expand Policies, expand Windows Settings, expand Security
Settings, expand File System, right-click Central Access Policy, and then click Manage Central
Access Policies.
6. Press and hold the Ctrl key and click both Department Match and Protect confidential docs, click
Add, and then click OK.
7. Close the Group Policy Management Editor and the Group Policy Management Console.
8. On LON-SVR1, on the taskbar, click the Windows PowerShell icon.
9. At a Windows PowerShell command prompt, type gpupdate /force, and then press Enter.
10. Close Windows PowerShell when you get the message that the Computer and User policies update
completed successfully.
11. On the taskbar, click the File Explorer icon.
12. In File Explorer, browse to Local Disk (C:), right-click the Docs folder, and then click Properties.
13. In the Properties dialog box, click the Security tab, and then click Advanced.
14. In the Advanced Security Settings for Docs window, click the Central Policy tab, and then click
Change.
Note: If the Central Policy tab does not appear, restart the virtual machine and try again.
15. In the drop-down list box, select Protect confidential docs. Ensure that in the Applies to dropdown list box value This folder, subfolders and files is selected, and then click OK twice.
16. Right-click the Research folder, and then click Properties.
17. In the Research Properties dialog box, click the Security tab, and then click Advanced.
18. In the Advanced Security Settings for Research window, click the Central Policy tab, and then click
Change.
19. In the drop-down list box, click Department Match. Ensure that in the Applies to drop-down list
box value This folder, subfolders and files is selected, and then click OK twice.
Results: After completing this exercise, you will have implemented DAC.

Exercise 3: Validating and Remediating DAC

Task 1: Evaluate user access with DAC

1. On LON-SVR1, on the taskbar, click the File Explorer icon.
2. In the File Explorer window, navigate to C:\Research, right-click Research, and then click Properties.
3. In the Properties dialog box, click the Security tab, click Advanced, and then click Effective Access.
4. Click Select a user, and in the Select User, Computer, Service Account, or Group window, type April,
click Check Names, and then click OK.
5. Click View effective access, and then review the results. The user April should not have access to this
folder. This is because she is not from the Research department, so she does not have a Research
value in her department attribute. In the effective access list, this will be shown as red cross sign on
each permission.
6. Click Include a user claim, and then in the drop-down list box, click Company Department.
7. In the Value drop-down list box, select Research, and then click View effective access. April should
now have read access. This is because you added April’s claim for the Research department. In the
effective access list, you should see green check marks on several permissions (Traverse Folder, List
Folder, Read Attributes, Read Extended Attributes and Read permissions).
8. Click Cancel two times.
9. In the File Explorer window, navigate to C:\Docs, open the folder, right-click Doc1.txt, and then click
Properties.
10. In the Properties dialog box, click the Security tab, click Advanced, and then click Effective Access.
11. Click Select a user, and in the Select User, Computer, Service Account, or Group window, type Aidan,
click Check Names, and then click OK.
12. Click View effective access, and then review the results. The user Aidan should not have access to
this folder. This is because the rule that protects this file has one more defined condition. In the
effective access list, this will be shown as a red cross sign on each permission.
13. Click Select a device, and in the Select Computer or Group window, type LON-SVR1, click Check
Names, and then click OK.
14. Click View effective access, and then verify the permissions in the list below. Aidan now should have
access as both conditions from the Central Access Rule are satisfied. In the effective access list you
should see green check marks on several permissions (Traverse folder, list folder, read attributes, read
extended attributes and read permissions).
15. Close all open windows.


Task 2: Configure access-denied remediation

1. On LON-DC1, in Server Manager, click Tools, and then click Group Policy Management.
Note: If the console does not open and a dialog box appears that says Group Policy
Management is loading, close the dialog box, and then try to open Group Policy Management
console again.
2. In the Group Policy Management Console, expand Forest: Adatum.com, expand Domains, expand
Adatum.com, and then click Group Policy objects.
3. Right-click DAC Policy, and then click Edit.
4. Under Computer Configuration, expand Policies, expand Administrative Templates, expand
System, and then click Access-Denied Assistance.
5. In the details pane, double-click Customize Message for Access Denied errors.
6. In the Customize Message for Access Denied errors window, click Enabled.
7. In the Display the following message to users who are denied access text box, type You are
denied access because of permission policy. Please request access.
8. Select the Enable users to request assistance check box.
9. Review the other options, but do not make any changes, and then click OK.
10. In the details pane of the Group Policy Management Editor window, double-click Enable accessdenied assistance on client for all file types, click Enabled, and then click OK.
11. Close the Group Policy Management Editor and the Group Policy Management Console.
12. Switch to LON-SVR1, and on the taskbar, click the Windows PowerShell icon.
13. At the Windows PowerShell command prompt, type gpupdate /force, and then press Enter.

Task 3: Request access remediation

1. Start LON-SVR1, and then sign in as Adatum\April with password Pa$$w0rd.
2. Click the Desktop tile, and then on the taskbar, click the File Explorer icon.
3. In the File Explorer address bar, type \\LON-SVR1\Research, and then press Enter. You should be
unable to access the folder.
4. Click Request assistance. Review the options for sending a message, and then click Close.
Note: If you don’t get Request assistance option, restart the LON-SVR1 machine, and try
again.
5. Sign out of LON-SVR1.
Results: After completing this exercise, you will have validated DAC functionality.

Exercise 4: Implementing Work Folders

Task 1: Installing Work Folders functionality and configuring an SSL certificate

1. On LON-SVR2, in Server Manager, click Add roles and features.
2. On the Before You Begin page, click Next.
3. On the Select installation type page, ensure that Role - based or feature - based installation is
selected, and then click Next.
4. On the Select destination server page, click Next.
5. On the Select server roles page, expand File and Storage Services, expand File and iSCSI Services,
and then select Work Folders.
6. In the Add features that are required for Work Folders dialog box, note the features, and then
click Add Features.
7. On the Select server roles page click Web Server (IIS). In the Add features that are required for
Web Server dialog box, note the features, and then click Add Features.
8. On the Select server roles page, click Next.
9. On the Select features page, click Next.
10. On the Web Server Role (IIS) page, click Next.
11. On the Select role services page, click Next.
12. On the Confirm installation selection pages, click Install.
13. When the installation finishes, click Close.
14. In the Server Manager on LON-SVR2, click Tools, and then click Internet Information Services (IIS)
Manager.
15. In the Internet Information Services (IIS) Manager console, click
LON-SVR2(ADATUM\Administrator), click No when prompted, and then double-click Server
Certificates in the middle pane.
16. In the Actions pane, click Create Domain Certificate.
17. In the Create Certificate window, fill in the text fields as follows, and then click Next:
o Common name: lon-svr2.adatum.com
o Organization: Adatum
o Organizational unit: IT
o City/locality: Seattle
o State/province: WA
o Country/region: US
18. On the Online Certification Authority page, click Select.
19. In the Select Certification Authority window, select AdatumCA, and then click OK.
20. In the Friendly name text box, type lon-svr2.adatum.com, and then click Finish.
21. In the IIS console, expand Sites, and then click on Default Web Site.
22. In the Actions pane, click Bindings.
23. In the Site Bindings window, click Add….
24. In the Add Site Binding window, under Type, select https. In the SSL certificate drop-down list, select
lon-svr2.adatum.com.
25. Click OK, and then click Close.
26. Close the Internet Information Services (IIS) Manager.

Task 2: Provisioning a share for Work Folders

1. On LON-SVR2, in Server Manager, in the navigation pane, click File and Storage Services.
2. Click Shares, and in the SHARES area, click Tasks, and then select New Share….
3. In the New Share Wizard, on the Select the profile for this share page, ensure that SMB Share –
Quick is selected, and then click Next.
4. On the Select the server and path for this share page, accept the defaults, and then click Next.
5. On the Specify share name page, in the Share name field, type WF-Share, and then click Next.
6. On the Configure share settings page, select Enable access - based enumeration, leave the other
settings at their defaults, and then click Next.
7. On the Specify permissions to control access page, note the default settings, and then click Next.
8. On the Confirm selections page, click Create.
9. On the View results page, click Close.

Task 3: Configuring and implementing Work Folders

1. On LON-SVR2, in Server Manager, expand File and Storage Services, and then click Work Folders.
2. In the WORK FOLDERS tile, click Tasks, and then click New Sync Share….
3. In the New Sync Share Wizard, on the Before you begin page, click Next.
4. On the Select the server and path page, select Select by file share, ensure that the share you
created in the previous task (WF-Share) is highlighted, and then click Next.
5. On the Specify the structure for user folders page, accept the default selection (user alias), and
then click Next.
6. On the Enter the sync share name page, accept the default, and then click Next.
7. On the Grant sync access to groups page, note the default selection to disable inherited
permissions and grant users exclusive access, and then click Add.
8. In the Select User or Group dialog box, in the Enter the object names to select field, type WFsync,
click Check Names, and then click OK.
9. On the Grant sync access to groups page, click Next.
10. On the Specify device policies page, clear both check boxes, and then click Next.
11. On the Confirm selections page, click Create.
12. On the View results page, click Close.
13. Switch to LON-DC1.
14. Open Server Manager, click Tools, and then click Group Policy Management.
Note: If the console does not open and a dialog box appears that says Group Policy
Management is loading, close the dialog box, and then try to open the Group Policy
Management console again.
15. Expand Forest: Adatum.com, expand Domains, expand Adatum.com, and then click Group Policy
Objects. Right-click Group Policy Objects, and then click New.
16. In the New GPO window, type Work Folders GPO in the Name field, and then click OK.
17. Right-click Work Folders GPO, and then click Edit.
18. In the Group Policy Management Editor window, expand User Configuration, expand Policies,
expand Administrative Templates, expand Windows Components, and then click Work Folders.
19. Double-click Specify Work Folders settings in the details pane, and then in the Specify Work
Folders settings dialog box, click Enabled.
20. In the Work Folders URL text box, type https://lon-svr2.adatum.com, and then select Force
automatic setup.
21. Click OK to close the Specify Work Folders settings dialog box, and then close the Group Policy
Management Editor window.
22. In the Group Policy Management Console, right-click the Adatum.com domain object, and then
select Link an Existing GPO….
23. In the Select GPO window, select Work Folders GPO, and then click OK.
24. Close the Group Policy Management Console.

Task 4: Validating Work Folders functionality

1. Sign in to LON-SVR1 as Adatum\Aidan with password Pa$$w0rd.
2. On Start screen, type PowerShell, and then click the Windows PowerShell icon in the Search pane.
3. At the Windows PowerShell command prompt, type gpupdate /force, and then press Enter.
Note: If you get an error when refreshing Group Policy, restart the machine and try again.
4. Open File Explorer, and then navigate to C:\Users\Aidan\.
5. Verify that the Work Folders folder has been created.
Note: The presence of the Work Folders folder indicates that the Work Folders
configuration is successful.
6. In File Explorer, create a few text files in the Work Folders folder.
Note: File Explorer displays the synchronization status of the files in the Work Folders
folder.
7. Right-click the Windows button on the taskbar, and then click Control Panel.
8. In Control Panel, click System and Security, and then click Work Folders.
9. Ensure that Work Folders are configured and working.
10. Close Control Panel.
11. Start LON-SVR2 and sign in as Adatum\Aidan with password Pa$$w0rd.
12. On the Start screen, type PowerShell, and then click the Windows PowerShell icon in the Search
pane.
13. At the Windows PowerShell command prompt, type gpupdate /force, and then press Enter.
Note: If you get an error when refreshing Group Policy, restart the machine and try again.
14. Open File Explorer, and then navigate to C:\Users\Aidan\.
15. Verify that the Work Folders folder is created.
16. Open the folder, and then verify that the files that you created on LON-SVR1 are present.


Prepare for the next module

When you finish the lab, revert the virtual machines to their initial state. To do this, complete the
following steps:
1. On the host computer, start Hyper-V Manager.
2. In the Virtual Machines list, right-click 10969B-LON-DC1, and then click Revert.
3. In the Revert Virtual Machine dialog box, click Revert.
4. Repeat steps two and three for LON-SVR3, LON-SVR1, LON-SVR2,
10969B-LON-SVR1, and 10969B-LON-SVR2.

